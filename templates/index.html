<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YouTube Downloader</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1>üéµ YouTube Media Downloader</h1>
        <p>Download your favorite songs or videos ‚Äî one link at a time.</p>
    </header>

    <main>
        <div class="container">
            <div id="process-container"></div>
            <button onclick="addProcess()" class="add-btn">‚ûï Add Another Link</button>

            <h2>üìÇ Downloaded Files</h2>
            <ul id="file-list" class="file-list"></ul>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Het Patel ‚Ä¢ Built with ‚ù§Ô∏è and FastAPI</p>
    </footer>

<script>
let processCount = 0;

function addProcess() {
    const container = document.getElementById("process-container");

    const div = document.createElement("div");
    div.className = "process-row";
    div.innerHTML = `
        <input type="text" class="link-input" placeholder="Paste YouTube link here" required>
        <select class="format-select">
            <option value="mp3">MP3</option>
            <option value="mp4">MP4</option>
        </select>
        <button onclick="download(this)" class="download-btn">Download</button>
        <span class="loader" style="display: none;"></span>
        <span class="status"></span>
    `;
    container.appendChild(div);
}

async function download(button) {
    const row = button.parentElement;
    const link = row.querySelector(".link-input").value;
    const format = row.querySelector(".format-select").value;
    const loader = row.querySelector(".loader");
    const status = row.querySelector(".status");

    if (!link.trim()) {
        alert("Please enter a link.");
        return;
    }

    loader.style.display = "inline-block";
    status.textContent = "";

    const formData = new FormData();
    formData.append("link", link);
    formData.append("format", format);

    const response = await fetch("/api/download", {
        method: "POST",
        body: formData
    });

    const result = await response.json();
    loader.style.display = "none";

    if (result.success) {
        status.textContent = "‚úÖ Done";
        loadDownloadedFiles();
    } else {
        status.textContent = "‚ùå " + result.message;
    }
}

async function loadDownloadedFiles() {
    const res = await fetch("/api/files");
    const data = await res.json();

    const list = document.getElementById("file-list");
    list.innerHTML = "";

    data.files.forEach(file => {
        const li = document.createElement("li");
        li.textContent = file;
        list.appendChild(li);
    });
}

window.onload = () => {
    addProcess(); // One input by default
    loadDownloadedFiles();
};
</script>
</body>
</html>
